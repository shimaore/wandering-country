// Generated by CoffeeScript 1.12.5
(function() {
  var app, app_version, couchapp, p_fun;

  app = 'wandering-country';

  app_version = '1.0';

  p_fun = require('coffeescript-helpers').p_fun;

  couchapp = function(arg) {
    var extra, normalize_account;
    normalize_account = arg.normalize_account;
    extra = "var normalize_account = " + normalize_account + ";";
    return {
      _id: "_design/" + app,
      version: app_version,
      language: 'javascript',
      views: {
        numbers_by_domain: {
          map: p_fun(function(doc) {
            var m;
            if (!((doc.type != null) && doc.type === 'number')) {
              return;
            }
            if (!(m = doc._id.match(/^number:[^@]+@(.+)$/))) {
              return;
            }
            return emit(m[1]);
          }),
          reduce: '_count'
        },
        endpoints_by_domain: {
          map: p_fun(function(doc) {
            var m;
            if (!((doc.type != null) && doc.type === 'endpoint')) {
              return;
            }
            if (!(m = doc._id.match(/^endpoint:[^@]+@(.+)$/))) {
              return;
            }
            return emit(m[1]);
          })
        },
        devices: {
          map: p_fun(extra, function(doc) {
            var account;
            if (!((doc.type != null) && doc.type === 'device')) {
              return;
            }
            if (doc.disabled) {
              return;
            }
            if (doc.account != null) {
              account = normalize_account(doc.account);
              return emit(['account', account]);
            }
          })
        },
        number_domains: {
          map: p_fun(extra, function(doc) {
            var account;
            if (!((doc.type != null) && doc.type === 'number_domain')) {
              return;
            }
            if (doc.disabled) {
              return;
            }
            if (doc.account != null) {
              account = normalize_account(doc.account);
              return emit(['account', account]);
            }
          })
        },
        endpoints: {
          map: p_fun(extra, function(doc) {
            var account, m;
            if (!((doc.type != null) && doc.type === 'endpoint')) {
              return;
            }
            if (doc.disabled) {
              return;
            }
            if (doc.account != null) {
              account = normalize_account(doc.account);
              emit(['account', account]);
            }
            m = doc._id.match(/^endpoint:[^@]+@(.+)$/);
            if ((m != null ? m[1] : void 0) != null) {
              return emit(['domain', m[1]]);
            }
          })
        },
        local_numbers: {
          map: p_fun(extra, function(doc) {
            var account, m;
            if (!((doc.type != null) && doc.type === 'number')) {
              return;
            }
            if (!(m = doc._id.match(/^number:[^@]+@(.+)$/))) {
              return;
            }
            if (doc.disabled) {
              return;
            }
            if (doc.account != null) {
              account = normalize_account(doc.account);
              emit(['account', account]);
            }
            if (m[1] != null) {
              return emit(['number_domain', m[1]]);
            }
          })
        },
        global_numbers: {
          map: p_fun(extra, function(doc) {
            var account, m;
            if (!((doc.type != null) && doc.type === 'number')) {
              return;
            }
            if (m = doc._id.match(/^number:[^@]+@(.+)$/)) {
              return;
            }
            if (doc.disabled) {
              return;
            }
            if (doc.account != null) {
              account = normalize_account(doc.account);
              emit(['account', account]);
            }
            if (doc.local_number != null) {
              return emit(['local_number', doc.local_number]);
            }
          })
        }
      }
    };
  };

  module.exports = {
    app: app,
    couchapp: couchapp
  };

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGVzaWduLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiZGVzaWduLmNvZmZlZS5tZCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUk7QUFBQSxNQUFBOztFQUFBLEdBQUEsR0FBTTs7RUFDTixXQUFBLEdBQWM7O0VBRWIsUUFBUyxPQUFBLENBQVEsc0JBQVI7O0VBRVYsUUFBQSxHQUFXLFNBQUMsR0FBRDtBQUNULFFBQUE7SUFEVyxvQkFBRDtJQUNWLEtBQUEsR0FBUSwwQkFBQSxHQUEyQixpQkFBM0IsR0FBNkM7V0FFckQ7TUFBQSxHQUFBLEVBQUssVUFBQSxHQUFXLEdBQWhCO01BQ0EsT0FBQSxFQUFTLFdBRFQ7TUFFQSxRQUFBLEVBQVUsWUFGVjtNQUdBLEtBQUEsRUFDRTtRQUFBLGlCQUFBLEVBQ0U7VUFBQSxHQUFBLEVBQUssS0FBQSxDQUFNLFNBQUMsR0FBRDtBQUNULGdCQUFBO1lBQUEsSUFBQSxDQUFBLENBQWMsa0JBQUEsSUFBYyxHQUFHLENBQUMsSUFBSixLQUFZLFFBQXhDLENBQUE7QUFBQSxxQkFBQTs7WUFDQSxJQUFBLENBQWMsQ0FBQSxDQUFBLEdBQUksR0FBRyxDQUFDLEdBQUcsQ0FBQyxLQUFSLENBQWMscUJBQWQsQ0FBSixDQUFkO0FBQUEscUJBQUE7O21CQUNBLElBQUEsQ0FBSyxDQUFFLENBQUEsQ0FBQSxDQUFQO1VBSFMsQ0FBTixDQUFMO1VBSUEsTUFBQSxFQUFRLFFBSlI7U0FERjtRQU9BLG1CQUFBLEVBQ0U7VUFBQSxHQUFBLEVBQUssS0FBQSxDQUFNLFNBQUMsR0FBRDtBQUNULGdCQUFBO1lBQUEsSUFBQSxDQUFBLENBQWMsa0JBQUEsSUFBYyxHQUFHLENBQUMsSUFBSixLQUFZLFVBQXhDLENBQUE7QUFBQSxxQkFBQTs7WUFDQSxJQUFBLENBQWMsQ0FBQSxDQUFBLEdBQUksR0FBRyxDQUFDLEdBQUcsQ0FBQyxLQUFSLENBQWMsdUJBQWQsQ0FBSixDQUFkO0FBQUEscUJBQUE7O21CQUNBLElBQUEsQ0FBSyxDQUFF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LElBQVUsR0FBRyxDQUFDLFFBQWQ7QUFBQSxxQkFBQTs7WUFFQSxJQUFHLG1CQUFIO2NBQ0UsT0FBQSxHQUFVLGlCQUFBLENBQWtCLEdBQUcsQ0FBQyxPQUF0QjtjQUNWLElBQUEsQ0FBSyxDQUFDLFNBQUQsRUFBVyxPQUFYLENBQUwsRUFGRjs7WUFJQSxJQUFHLHdCQUFIO3FCQUNFLElBQUEsQ0FBSyxDQUFDLGNBQUQsRUFBZ0IsR0FBRyxDQUFDLFlBQXBCLENBQUwsRUFERjs7VUFUZ0IsQ0FBYixDQUFMO1NBOURGO09BSkY7O0VBSFM7O0VBaUZYLE1BQU0sQ0FBQyxPQUFQLEdBQWlCO0lBQUMsS0FBQSxHQUFEO0lBQUssVUFBQSxRQUFMOztBQXRGakIiLCJzb3VyY2VzQ29udGVudCI6WyIgICAgYXBwID0gJ3dhbmRlcmluZy1jb3VudHJ5J1xuICAgIGFwcF92ZXJzaW9uID0gJzEuMCdcblxuICAgIHtwX2Z1bn0gPSByZXF1aXJlICdjb2ZmZWVzY3JpcHQtaGVscGVycydcblxuICAgIGNvdWNoYXBwID0gKHtub3JtYWxpemVfYWNjb3VudH0pIC0+XG4gICAgICBleHRyYSA9IFwidmFyIG5vcm1hbGl6ZV9hY2NvdW50ID0gI3tub3JtYWxpemVfYWNjb3VudH07XCJcblxuICAgICAgX2lkOiBcIl9kZXNpZ24vI3thcHB9XCJcbiAgICAgIHZlcnNpb246IGFwcF92ZXJzaW9uXG4gICAgICBsYW5ndWFnZTogJ2phdmFzY3JpcHQnXG4gICAgICB2aWV3czpcbiAgICAgICAgbnVtYmVyc19ieV9kb21haW46XG4gICAgICAgICAgbWFwOiBwX2Z1biAoZG9jKSAtPlxuICAgICAgICAgICAgcmV0dXJuIHVubGVzcyBkb2MudHlwZT8gYW5kIGRvYy50eXBlIGlzICdudW1iZXInXG4gICAgICAgICAgICByZXR1cm4gdW5sZXNzIG0gPSBkb2MuX2lkLm1hdGNoIC9ebnVtYmVyOlteQF0rQCguKykkL1xuICAgICAgICAgICAgZW1pdCBtWzFdXG4gICAgICAgICAgcmVkdWNlOiAnX2NvdW50J1xuXG4gICAgICAgIGVuZHBvaW50c19ieV9kb21haW46XG4gICAgICAgICAgbWFwOiBwX2Z1biAoZG9jKSAtPlxuICAgICAgICAgICAgcmV0dXJuIHVubGVzcyBkb2MudHlwZT8gYW5kIGRvYy50eXBlIGlzICdlbmRwb2ludCdcbiAgICAgICAgICAgIHJldHVybiB1bmxlc3MgbSA9IGRvYy5faWQubWF0Y2ggL15lbmRwb2ludDpbXkBdK0AoLispJC9cbiAgICAgICAgICAgIGVtaXQgbVsxXVxuXG4gICAgICAgIGRldmljZXM6XG4gICAgICAgICAgbWFwOiBwX2Z1biBleHRyYSwgKGRvYykgLT5cbiAgICAgICAgICAgIHJldHVybiB1bmxlc3MgZG9jLnR5cGU/IGFuZCBkb2MudHlwZSBpcyAnZGV2aWNlJ1xuICAgICAgICAgICAgcmV0dXJuIGlmIGRvYy5kaXNhYmxlZFxuXG4gICAgICAgICAgICBpZiBkb2MuYWNjb3VudD9cbiAgICAgICAgICAgICAgYWNjb3VudCA9IG5vcm1hbGl6ZV9hY2NvdW50IGRvYy5hY2NvdW50XG4gICAgICAgICAgICAgIGVtaXQgWydhY2NvdW50JyxhY2NvdW50XVxuXG4gICAgICAgIG51bWJlcl9kb21haW5zOlxuICAgICAgICAgIG1hcDogcF9mdW4gZXh0cmEsIChkb2MpIC0+XG4gICAgICAgICAgICByZXR1cm4gdW5sZXNzIGRvYy50eXBlPyBhbmQgZG9jLnR5cGUgaXMgJ251bWJlcl9kb21haW4nXG4gICAgICAgICAgICByZXR1cm4gaWYgZG9jLmRpc2FibGVkXG5cbiAgICAgICAgICAgIGlmIGRvYy5hY2NvdW50P1xuICAgICAgICAgICAgICBhY2NvdW50ID0gbm9ybWFsaXplX2FjY291bnQgZG9jLmFjY291bnRcbiAgICAgICAgICAgICAgZW1pdCBbJ2FjY291bnQnLGFjY291bnRdXG5cbiAgICAgICAgZW5kcG9pbnRzOlxuICAgICAgICAgIG1hcDogcF9mdW4gZXh0cmEsIChkb2MpIC0+XG4gICAgICAgICAgICByZXR1cm4gdW5sZXNzIGRvYy50eXBlPyBhbmQgZG9jLnR5cGUgaXMgJ2VuZHBvaW50J1xuICAgICAgICAgICAgcmV0dXJuIGlmIGRvYy5kaXNhYmxlZFxuXG4gICAgICAgICAgICBpZiBkb2MuYWNjb3VudD9cbiAgICAgICAgICAgICAgYWNjb3VudCA9IG5vcm1hbGl6ZV9hY2NvdW50IGRvYy5hY2NvdW50XG4gICAgICAgICAgICAgIGVtaXQgWydhY2NvdW50JyxhY2NvdW50XVxuXG4gICAgICAgICAgICBtID0gZG9jLl9pZC5tYXRjaCAvXmVuZHBvaW50OlteQF0rQCguKykkL1xuICAgICAgICAgICAgaWYgbT9bMV0/XG4gICAgICAgICAgICAgIGVtaXQgWydkb21haW4nLG1bMV1dXG5cbiAgICAgICAgbG9jYWxfbnVtYmVyczpcbiAgICAgICAgICBtYXA6IHBfZnVuIGV4dHJhLCAoZG9jKSAtPlxuICAgICAgICAgICAgcmV0dXJuIHVubGVzcyBkb2MudHlwZT8gYW5kIGRvYy50eXBlIGlzICdudW1iZXInXG4gICAgICAgICAgICByZXR1cm4gdW5sZXNzIG0gPSBkb2MuX2lkLm1hdGNoIC9ebnVtYmVyOlteQF0rQCguKykkL1xuICAgICAgICAgICAgcmV0dXJuIGlmIGRvYy5kaXNhYmxlZFxuXG4gICAgICAgICAgICBpZiBkb2MuYWNjb3VudD9cbiAgICAgICAgICAgICAgYWNjb3VudCA9IG5vcm1hbGl6ZV9hY2NvdW50IGRvYy5hY2NvdW50XG4gICAgICAgICAgICAgIGVtaXQgWydhY2NvdW50JyxhY2NvdW50XVxuXG4gICAgICAgICAgICBpZiBtWzFdP1xuICAgICAgICAgICAgICBlbWl0IFsnbnVtYmVyX2RvbWFpbicsbVsxXV1cblxuVmlldyBmb3IgKGFkbWluKSByb3V0aW5nIG9mIGdsb2JhbCBudW1iZXJzLlxuVGhlIHZpZXcgbGlzdHMgYWxsIGdsb2JhbCBudW1iZXJzIGZvciBhIGdpdmVuIGFjY291bnQuXG5UaGUgdmlldyBsaXN0cyB0aGUgZ2xvYmFsIG51bWJlcihzKSByb3V0aW5nIHRvIGEgZ2l2ZW4gbG9jYWwtbnVtYmVyLlxuXG4gICAgICAgIGdsb2JhbF9udW1iZXJzOlxuICAgICAgICAgIG1hcDogcF9mdW4gZXh0cmEsIChkb2MpIC0+XG4gICAgICAgICAgICByZXR1cm4gdW5sZXNzIGRvYy50eXBlPyBhbmQgZG9jLnR5cGUgaXMgJ251bWJlcidcbiAgICAgICAgICAgIHJldHVybiBpZiBtID0gZG9jLl9pZC5tYXRjaCAvXm51bWJlcjpbXkBdK0AoLispJC9cbiAgICAgICAgICAgIHJldHVybiBpZiBkb2MuZGlzYWJsZWRcblxuICAgICAgICAgICAgaWYgZG9jLmFjY291bnQ/XG4gICAgICAgICAgICAgIGFjY291bnQgPSBub3JtYWxpemVfYWNjb3VudCBkb2MuYWNjb3VudFxuICAgICAgICAgICAgICBlbWl0IFsnYWNjb3VudCcsYWNjb3VudF1cblxuICAgICAgICAgICAgaWYgZG9jLmxvY2FsX251bWJlcj9cbiAgICAgICAgICAgICAgZW1pdCBbJ2xvY2FsX251bWJlcicsZG9jLmxvY2FsX251bWJlcl1cblxuICAgIG1vZHVsZS5leHBvcnRzID0ge2FwcCxjb3VjaGFwcH1cbiJdfQ==
//# sourceURL=/srv/home/stephane/Artisan/Managed/Telecoms/wandering-country/design.coffee.md