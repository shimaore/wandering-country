// Generated by CoffeeScript 1.12.4
(function() {
  var app, app_version, ddoc, p_fun;

  app = 'wandering-country';

  app_version = '1.0';

  p_fun = require('coffeescript-helpers').p_fun;

  ddoc = function(arg) {
    var extra, normalize_account;
    normalize_account = arg.normalize_account;
    extra = "var normalize_account = " + normalize_account + ";";
    return {
      _id: "_design/" + app,
      version: app_version,
      language: 'javascript',
      views: {
        numbers_by_domain: {
          map: p_fun(function(doc) {
            var m;
            if (!((doc.type != null) && doc.type === 'number')) {
              return;
            }
            if (!(m = doc._id.match(/^number:[^@]+@(.+)$/))) {
              return;
            }
            return emit(m[1]);
          }),
          reduce: '_count'
        },
        endpoints_by_domain: {
          map: p_fun(function(doc) {
            var m;
            if (!((doc.type != null) && doc.type === 'endpoint')) {
              return;
            }
            if (!(m = doc._id.match(/^endpoint:[^@]+@(.+)$/))) {
              return;
            }
            return emit(m[1]);
          })
        },
        devices: {
          map: p_fun(extra, function(doc) {
            var account;
            if (!((doc.type != null) && doc.type === 'device')) {
              return;
            }
            if (doc.disabled) {
              return;
            }
            if (doc.account != null) {
              account = normalize_account(doc.account);
              return emit(['account', account]);
            }
          })
        },
        number_domains: {
          map: p_fun(extra, function(doc) {
            var account;
            if (!((doc.type != null) && doc.type === 'number_domain')) {
              return;
            }
            if (doc.disabled) {
              return;
            }
            if (doc.account != null) {
              account = normalize_account(doc.account);
              return emit(['account', account]);
            }
          })
        },
        endpoints: {
          map: p_fun(extra, function(doc) {
            var account, m;
            if (!((doc.type != null) && doc.type === 'endpoint')) {
              return;
            }
            if (doc.disabled) {
              return;
            }
            if (doc.account != null) {
              account = normalize_account(doc.account);
              emit(['account', account]);
            }
            m = doc._id.match(/^endpoint:[^@]+@(.+)$/);
            if ((m != null ? m[1] : void 0) != null) {
              return emit(['domain', m[1]]);
            }
          })
        },
        local_numbers: {
          map: p_fun(extra, function(doc) {
            var account, m;
            if (!((doc.type != null) && doc.type === 'number')) {
              return;
            }
            if (!(m = doc._id.match(/^number:[^@]+@(.+)$/))) {
              return;
            }
            if (doc.disabled) {
              return;
            }
            if (doc.account != null) {
              account = normalize_account(doc.account);
              emit(['account', account]);
            }
            if (m[1] != null) {
              return emit(['number_domain', m[1]]);
            }
          })
        },
        global_numbers: {
          map: p_fun(extra, function(doc) {
            var account, m;
            if (!((doc.type != null) && doc.type === 'number')) {
              return;
            }
            if (m = doc._id.match(/^number:[^@]+@(.+)$/)) {
              return;
            }
            if (doc.disabled) {
              return;
            }
            if (doc.account != null) {
              account = normalize_account(doc.account);
              emit(['account', account]);
            }
            if (doc.local_number != null) {
              return emit(['local_number', doc.local_number]);
            }
          })
        }
      }
    };
  };

  module.exports = {
    app: app,
    app_version: app_version,
    ddoc: ddoc
  };

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGVzaWduLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiZGVzaWduLmNvZmZlZS5tZCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUk7QUFBQSxNQUFBOztFQUFBLEdBQUEsR0FBTTs7RUFDTixXQUFBLEdBQWM7O0VBRWIsUUFBUyxPQUFBLENBQVEsc0JBQVI7O0VBRVYsSUFBQSxHQUFPLFNBQUMsR0FBRDtBQUNMLFFBQUE7SUFETyxvQkFBRDtJQUNOLEtBQUEsR0FBUSwwQkFBQSxHQUEyQixpQkFBM0IsR0FBNkM7V0FFckQ7TUFBQSxHQUFBLEVBQUssVUFBQSxHQUFXLEdBQWhCO01BQ0EsT0FBQSxFQUFTLFdBRFQ7TUFFQSxRQUFBLEVBQVUsWUFGVjtNQUdBLEtBQUEsRUFDRTtRQUFBLGlCQUFBLEVBQ0U7VUFBQSxHQUFBLEVBQUssS0FBQSxDQUFNLFNBQUMsR0FBRDtBQUNULGdCQUFBO1lBQUEsSUFBQSxDQUFBLENBQWMsa0JBQUEsSUFBYyxHQUFHLENBQUMsSUFBSixLQUFZLFFBQXhDLENBQUE7QUFBQSxxQkFBQTs7WUFDQSxJQUFBLENBQWMsQ0FBQSxDQUFBLEdBQUksR0FBRyxDQUFDLEdBQUcsQ0FBQyxLQUFSLENBQWMscUJBQWQsQ0FBSixDQUFkO0FBQUEscUJBQUE7O21CQUNBLElBQUEsQ0FBSyxDQUFFLENBQUEsQ0FBQSxDQUFQO1VBSFMsQ0FBTixDQUFMO1VBSUEsTUFBQSxFQUFRLFFBSlI7U0FERjtRQU9BLG1CQUFBLEVBQ0U7VUFBQSxHQUFBLEVBQUssS0FBQSxDQUFNLFNBQUMsR0FBRDtBQUNULGdCQUFBO1lBQUEsSUFBQSxDQUFBLENBQWMsa0JBQUEsSUFBYyxHQUFHLENBQUMsSUFBSixLQUFZLFVBQXhDLENBQUE7QUFBQSxxQkFBQTs7WUFDQSxJQUFBLENBQWMsQ0FBQSxDQUFBLEdBQUksR0FBRyxDQUFDLEdBQUcsQ0FBQyxLQUFSLENBQWMsdUJBQWQsQ0FBSixDQUFkO0FBQUEscUJBQUE7O21CQUNBLElBQUEsQ0FBSyxDQUFF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LElBQVUsR0FBRyxDQUFDLFFBQWQ7QUFBQSxxQkFBQTs7WUFFQSxJQUFHLG1CQUFIO2NBQ0UsT0FBQSxHQUFVLGlCQUFBLENBQWtCLEdBQUcsQ0FBQyxPQUF0QjtjQUNWLElBQUEsQ0FBSyxDQUFDLFNBQUQsRUFBVyxPQUFYLENBQUwsRUFGRjs7WUFJQSxJQUFHLHdCQUFIO3FCQUNFLElBQUEsQ0FBSyxDQUFDLGNBQUQsRUFBZ0IsR0FBRyxDQUFDLFlBQXBCLENBQUwsRUFERjs7VUFUZ0IsQ0FBYixDQUFMO1NBOURGO09BSkY7O0VBSEs7O0VBaUZQLE1BQU0sQ0FBQyxPQUFQLEdBQWlCO0lBQUMsS0FBQSxHQUFEO0lBQUssYUFBQSxXQUFMO0lBQWlCLE1BQUEsSUFBakI7O0FBdEZqQiIsInNvdXJjZXNDb250ZW50IjpbIiAgICBhcHAgPSAnd2FuZGVyaW5nLWNvdW50cnknXG4gICAgYXBwX3ZlcnNpb24gPSAnMS4wJ1xuXG4gICAge3BfZnVufSA9IHJlcXVpcmUgJ2NvZmZlZXNjcmlwdC1oZWxwZXJzJ1xuXG4gICAgZGRvYyA9ICh7bm9ybWFsaXplX2FjY291bnR9KSAtPlxuICAgICAgZXh0cmEgPSBcInZhciBub3JtYWxpemVfYWNjb3VudCA9ICN7bm9ybWFsaXplX2FjY291bnR9O1wiXG5cbiAgICAgIF9pZDogXCJfZGVzaWduLyN7YXBwfVwiXG4gICAgICB2ZXJzaW9uOiBhcHBfdmVyc2lvblxuICAgICAgbGFuZ3VhZ2U6ICdqYXZhc2NyaXB0J1xuICAgICAgdmlld3M6XG4gICAgICAgIG51bWJlcnNfYnlfZG9tYWluOlxuICAgICAgICAgIG1hcDogcF9mdW4gKGRvYykgLT5cbiAgICAgICAgICAgIHJldHVybiB1bmxlc3MgZG9jLnR5cGU/IGFuZCBkb2MudHlwZSBpcyAnbnVtYmVyJ1xuICAgICAgICAgICAgcmV0dXJuIHVubGVzcyBtID0gZG9jLl9pZC5tYXRjaCAvXm51bWJlcjpbXkBdK0AoLispJC9cbiAgICAgICAgICAgIGVtaXQgbVsxXVxuICAgICAgICAgIHJlZHVjZTogJ19jb3VudCdcblxuICAgICAgICBlbmRwb2ludHNfYnlfZG9tYWluOlxuICAgICAgICAgIG1hcDogcF9mdW4gKGRvYykgLT5cbiAgICAgICAgICAgIHJldHVybiB1bmxlc3MgZG9jLnR5cGU/IGFuZCBkb2MudHlwZSBpcyAnZW5kcG9pbnQnXG4gICAgICAgICAgICByZXR1cm4gdW5sZXNzIG0gPSBkb2MuX2lkLm1hdGNoIC9eZW5kcG9pbnQ6W15AXStAKC4rKSQvXG4gICAgICAgICAgICBlbWl0IG1bMV1cblxuICAgICAgICBkZXZpY2VzOlxuICAgICAgICAgIG1hcDogcF9mdW4gZXh0cmEsIChkb2MpIC0+XG4gICAgICAgICAgICByZXR1cm4gdW5sZXNzIGRvYy50eXBlPyBhbmQgZG9jLnR5cGUgaXMgJ2RldmljZSdcbiAgICAgICAgICAgIHJldHVybiBpZiBkb2MuZGlzYWJsZWRcblxuICAgICAgICAgICAgaWYgZG9jLmFjY291bnQ/XG4gICAgICAgICAgICAgIGFjY291bnQgPSBub3JtYWxpemVfYWNjb3VudCBkb2MuYWNjb3VudFxuICAgICAgICAgICAgICBlbWl0IFsnYWNjb3VudCcsYWNjb3VudF1cblxuICAgICAgICBudW1iZXJfZG9tYWluczpcbiAgICAgICAgICBtYXA6IHBfZnVuIGV4dHJhLCAoZG9jKSAtPlxuICAgICAgICAgICAgcmV0dXJuIHVubGVzcyBkb2MudHlwZT8gYW5kIGRvYy50eXBlIGlzICdudW1iZXJfZG9tYWluJ1xuICAgICAgICAgICAgcmV0dXJuIGlmIGRvYy5kaXNhYmxlZFxuXG4gICAgICAgICAgICBpZiBkb2MuYWNjb3VudD9cbiAgICAgICAgICAgICAgYWNjb3VudCA9IG5vcm1hbGl6ZV9hY2NvdW50IGRvYy5hY2NvdW50XG4gICAgICAgICAgICAgIGVtaXQgWydhY2NvdW50JyxhY2NvdW50XVxuXG4gICAgICAgIGVuZHBvaW50czpcbiAgICAgICAgICBtYXA6IHBfZnVuIGV4dHJhLCAoZG9jKSAtPlxuICAgICAgICAgICAgcmV0dXJuIHVubGVzcyBkb2MudHlwZT8gYW5kIGRvYy50eXBlIGlzICdlbmRwb2ludCdcbiAgICAgICAgICAgIHJldHVybiBpZiBkb2MuZGlzYWJsZWRcblxuICAgICAgICAgICAgaWYgZG9jLmFjY291bnQ/XG4gICAgICAgICAgICAgIGFjY291bnQgPSBub3JtYWxpemVfYWNjb3VudCBkb2MuYWNjb3VudFxuICAgICAgICAgICAgICBlbWl0IFsnYWNjb3VudCcsYWNjb3VudF1cblxuICAgICAgICAgICAgbSA9IGRvYy5faWQubWF0Y2ggL15lbmRwb2ludDpbXkBdK0AoLispJC9cbiAgICAgICAgICAgIGlmIG0/WzFdP1xuICAgICAgICAgICAgICBlbWl0IFsnZG9tYWluJyxtWzFdXVxuXG4gICAgICAgIGxvY2FsX251bWJlcnM6XG4gICAgICAgICAgbWFwOiBwX2Z1biBleHRyYSwgKGRvYykgLT5cbiAgICAgICAgICAgIHJldHVybiB1bmxlc3MgZG9jLnR5cGU/IGFuZCBkb2MudHlwZSBpcyAnbnVtYmVyJ1xuICAgICAgICAgICAgcmV0dXJuIHVubGVzcyBtID0gZG9jLl9pZC5tYXRjaCAvXm51bWJlcjpbXkBdK0AoLispJC9cbiAgICAgICAgICAgIHJldHVybiBpZiBkb2MuZGlzYWJsZWRcblxuICAgICAgICAgICAgaWYgZG9jLmFjY291bnQ/XG4gICAgICAgICAgICAgIGFjY291bnQgPSBub3JtYWxpemVfYWNjb3VudCBkb2MuYWNjb3VudFxuICAgICAgICAgICAgICBlbWl0IFsnYWNjb3VudCcsYWNjb3VudF1cblxuICAgICAgICAgICAgaWYgbVsxXT9cbiAgICAgICAgICAgICAgZW1pdCBbJ251bWJlcl9kb21haW4nLG1bMV1dXG5cblZpZXcgZm9yIChhZG1pbikgcm91dGluZyBvZiBnbG9iYWwgbnVtYmVycy5cblRoZSB2aWV3IGxpc3RzIGFsbCBnbG9iYWwgbnVtYmVycyBmb3IgYSBnaXZlbiBhY2NvdW50LlxuVGhlIHZpZXcgbGlzdHMgdGhlIGdsb2JhbCBudW1iZXIocykgcm91dGluZyB0byBhIGdpdmVuIGxvY2FsLW51bWJlci5cblxuICAgICAgICBnbG9iYWxfbnVtYmVyczpcbiAgICAgICAgICBtYXA6IHBfZnVuIGV4dHJhLCAoZG9jKSAtPlxuICAgICAgICAgICAgcmV0dXJuIHVubGVzcyBkb2MudHlwZT8gYW5kIGRvYy50eXBlIGlzICdudW1iZXInXG4gICAgICAgICAgICByZXR1cm4gaWYgbSA9IGRvYy5faWQubWF0Y2ggL15udW1iZXI6W15AXStAKC4rKSQvXG4gICAgICAgICAgICByZXR1cm4gaWYgZG9jLmRpc2FibGVkXG5cbiAgICAgICAgICAgIGlmIGRvYy5hY2NvdW50P1xuICAgICAgICAgICAgICBhY2NvdW50ID0gbm9ybWFsaXplX2FjY291bnQgZG9jLmFjY291bnRcbiAgICAgICAgICAgICAgZW1pdCBbJ2FjY291bnQnLGFjY291bnRdXG5cbiAgICAgICAgICAgIGlmIGRvYy5sb2NhbF9udW1iZXI/XG4gICAgICAgICAgICAgIGVtaXQgWydsb2NhbF9udW1iZXInLGRvYy5sb2NhbF9udW1iZXJdXG5cbiAgICBtb2R1bGUuZXhwb3J0cyA9IHthcHAsYXBwX3ZlcnNpb24sZGRvY31cbiJdfQ==
//# sourceURL=/srv/home/stephane/Artisan/Managed/Telecoms/wandering-country/design.coffee.md